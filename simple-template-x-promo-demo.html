<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template X Promo Demo - API Powered!</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .demo-section { 
            background: white; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        .loading { 
            text-align: center; 
            padding: 40px; 
            color: #666; 
        }
        .template-container { 
            display: flex; 
            gap: 20px; 
            overflow-x: auto; 
            padding: 10px 0; 
        }
        .template-card {
            min-width: 200px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .template-card:hover {
            transform: translateY(-4px);
        }
        .template-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        .template-info {
            padding: 15px;
        }
        .template-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .template-license {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .license-free {
            background: #e8f5e8;
            color: #2d5a2d;
        }
        .license-premium {
            background: #fff3cd;
            color: #856404;
        }
        .edit-button {
            display: block;
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            background: #0066cc;
            color: white;
            text-decoration: none;
            text-align: center;
            border-radius: 4px;
            font-size: 12px;
        }
        .edit-button:hover {
            background: #0052a3;
        }
        .recipe-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 15px;
            word-break: break-all;
        }
        .api-url {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            margin-bottom: 15px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>üé® Template X Promo - API Demo</h1>
    <p>Watch our <code>template-x-promo</code> block fetch real Adobe Express templates!</p>

    <div class="demo-section">
        <h2>üìù Recipe Format (Author-Friendly)</h2>
        <div class="recipe-display">
            collection=default&templateIds=urn:aaid:sc:VA6C2:12053b1e-8454-4fda-8fd8-244e5eb7d060,urn:aaid:sc:VA6C2:e2797332-b3ba-40cf-8ea1-23d3a1c87791,urn:aaid:sc:VA6C2:3c674431-f00a-5500-962b-75b847af95d5
        </div>
        <div class="api-url" id="api-url"></div>
        <div id="templates-container" class="loading">üîÑ Loading templates from Adobe Express API...</div>
    </div>

    <script>
        // Template X Promo Logic (Simplified)
        function convertRecipeToApiUrl(recipeString) {
            const params = new URLSearchParams(recipeString);
            const templateIds = params.get('templateIds');
            const collection = params.get('collection') || 'default';
            
            const baseUrl = 'https://www.adobe.com/express-search-api-v3';
            const collectionId = collection === 'default' 
                ? 'urn:aaid:sc:VA6C2:25a82757-01de-4dd9-b0ee-bde51dd3b418'
                : 'urn:aaid:sc:VA6C2:a6767752-9c76-493e-a9e8-49b54b3b9852';

            const filters = `id==${templateIds.split(',').map(id => id.trim()).join(',')}`;
            return `${baseUrl}?queryType=search&collectionId=${collectionId}&filters=${filters}&ax-env=stage`;
        }

        async function fetchAndDisplayTemplates() {
            const recipe = 'collection=default&templateIds=urn:aaid:sc:VA6C2:12053b1e-8454-4fda-8fd8-244e5eb7d060,urn:aaid:sc:VA6C2:e2797332-b3ba-40cf-8ea1-23d3a1c87791,urn:aaid:sc:VA6C2:3c674431-f00a-5500-962b-75b847af95d5';
            const apiUrl = convertRecipeToApiUrl(recipe);
            
            // Show the API URL
            document.getElementById('api-url').textContent = `üîó Generated API URL: ${apiUrl}`;
            
            try {
                console.log('Fetching from:', apiUrl);
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                if (!data.items || data.items.length === 0) {
                    throw new Error('No templates found');
                }

                renderTemplates(data.items);
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('templates-container').innerHTML = `
                    <div style="color: red; text-align: center; padding: 20px;">
                        ‚ùå Error loading templates: ${error.message}<br>
                        <small>Check console for details. This might be a CORS issue when running locally.</small>
                    </div>
                `;
            }
        }

        function renderTemplates(templates) {
            const container = document.getElementById('templates-container');
            container.className = 'template-container';
            container.innerHTML = '';

            templates.forEach(template => {
                const card = document.createElement('div');
                card.className = 'template-card';
                
                const thumbnail = template.pages?.[0]?.rendition?.image?.thumbnail;
                const title = template['dc:title']?.['i-default'] || 'Untitled Template';
                const license = template.licensingCategory || 'free';
                const branchUrl = template.customLinks?.branchUrl || '#';
                
                card.innerHTML = `
                    <img class="template-image" 
                         src="https://design-assets.adobeprojectm.com/content/download/express/public/${template.id}/component?component_id=${thumbnail?.componentId}&revision=${thumbnail?.hzRevision || '0'}" 
                         alt="${title}"
                         onerror="this.src='https://via.placeholder.com/200x300/f0f0f0/999?text=Template'"
                    >
                    <div class="template-info">
                        <div class="template-title">${title}</div>
                        <span class="template-license license-${license}">${license.toUpperCase()}</span>
                        <a href="${branchUrl}" class="edit-button" target="_blank">‚úèÔ∏è Edit this template</a>
                    </div>
                `;
                
                container.appendChild(card);
            });

            // Add success message
            const successMsg = document.createElement('div');
            successMsg.innerHTML = `<p style="text-align: center; color: #28a745; font-weight: 600; margin-top: 20px;">‚úÖ Successfully loaded ${templates.length} templates!</p>`;
            container.parentElement.appendChild(successMsg);
        }

        // Load templates on page load
        fetchAndDisplayTemplates();
    </script>
</body>
</html>
