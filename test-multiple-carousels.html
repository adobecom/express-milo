<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple Carousels Test</title>
    <link rel="stylesheet" href="express/code/blocks/template-x-promo/template-x-promo.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        .test-section {
            margin: 40px auto;
            max-width: 1200px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .test-section.four { border-left: 6px solid #007acc; }
        .test-section.three { border-left: 6px solid #28a745; }
        .test-section.two { border-left: 6px solid #ffc107; }
        
        .test-title {
            margin: 0 0 20px;
            font-size: 20px;
            font-weight: bold;
        }
        
        .test-title.four { color: #007acc; }
        .test-title.three { color: #28a745; }
        .test-title.two { color: #ffc107; }
        
        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        /* Make sure our carousel sections have the right classes */
        .section.ax-template-x-promo {
            background: transparent;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h1>üé† Multiple Carousels Testing</h1>
        <p><strong>Instructions:</strong> Resize your window to see mobile vs desktop behavior on all carousels below</p>
        <p>üì± <strong>Mobile (&lt;768px):</strong> 3-up carousel with navigation buttons</p>
        <p>üñ•Ô∏è <strong>Desktop (‚â•768px):</strong> All templates side-by-side, no buttons</p>
    </div>

    <!-- 4 Templates Carousel -->
    <div class="test-section four">
        <h2 class="test-title four">üîµ 4 Templates Carousel</h2>
        <div class="section ax-template-x-promo multiple-up">
            <div class="template-x-promo horizontal three template-x" id="carousel-4">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- 3 Templates Carousel -->
    <div class="test-section three">
        <h2 class="test-title three">üü¢ 3 Templates Carousel</h2>
        <div class="section ax-template-x-promo multiple-up">
            <div class="template-x-promo horizontal three template-x" id="carousel-3">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- 2 Templates Carousel -->
    <div class="test-section two">
        <h2 class="test-title two">üü° 2 Templates Carousel</h2>
        <div class="section ax-template-x-promo multiple-up">
            <div class="template-x-promo horizontal three template-x" id="carousel-2">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Set up mock utility functions FIRST - before any module imports
        window.createTag = (tag, attributes = {}) => {
            const element = document.createElement(tag);
            Object.entries(attributes).forEach(([key, value]) => {
                if (key === 'class') {
                    element.className = value;
                } else {
                    element.setAttribute(key, value);
                }
            });
            return element;
        };

        window.getLibs = () => Promise.resolve({
            createTag: window.createTag
        });
        
        window.getIconElementDeprecated = (iconName) => {
            const icon = document.createElement('div');
            icon.className = `icon icon-${iconName}`;
            icon.textContent = iconName === 'premium' ? 'üëë' : 'üì§';
            return icon;
        };
        
        window.replaceKey = (key) => Promise.resolve('Edit this template');
        window.getConfig = () => ({});
    </script>

    <script type="module">
        // Mock data - 4 templates with working placeholder images
        const mockTemplates = [
            {
                'dc:title': { 'i-default': 'Good Morning Template 1' },
                thumbnail: 'https://picsum.photos/255/340?random=1',
                licensingCategory: 'free',
                customLinks: { branchUrl: '#template1' }
            },
            {
                'dc:title': { 'i-default': 'Good Morning Template 2' },
                thumbnail: 'https://picsum.photos/255/340?random=2',
                licensingCategory: 'premium',
                customLinks: { branchUrl: '#template2' }
            },
            {
                'dc:title': { 'i-default': 'Good Morning Template 3' },
                thumbnail: 'https://picsum.photos/255/340?random=3',
                licensingCategory: 'free',
                customLinks: { branchUrl: '#template3' }
            },
            {
                'dc:title': { 'i-default': 'Good Morning Template 4' },
                thumbnail: 'https://picsum.photos/255/340?random=4',
                licensingCategory: 'premium',
                customLinks: { branchUrl: '#template4' }
            }
        ];

        // Import and use our carousel module
        try {
            const module = await import('./express/code/blocks/template-x-promo/template-x-promo.js');
            
            // Create carousels for each block
            const block4 = document.getElementById('carousel-4');
            const block3 = document.getElementById('carousel-3');
            const block2 = document.getElementById('carousel-2');

            // Simulate the handleApiDrivenTemplates function call for each
            console.log('üé† Creating 4-template carousel...');
            await simulateCarousel(block4, mockTemplates.slice(0, 4));

            console.log('üé† Creating 3-template carousel...');
            await simulateCarousel(block3, mockTemplates.slice(0, 3));

            console.log('üé† Creating 2-template carousel...');
            await simulateCarousel(block2, mockTemplates.slice(0, 2));

            console.log('‚úÖ All carousels created!');

        } catch (error) {
            console.error('‚ùå Error loading carousel:', error);
            document.body.innerHTML = '<div style="text-align:center;padding:50px;color:red;">Error loading carousel module</div>';
        }

        // Simulate the carousel creation process
        async function simulateCarousel(block, templates) {
            // Add the parent class structure that our CSS expects
            const parent = block.parentElement;
            parent.classList.add('multiple-up');
            block.classList.add('custom-promo-carousel');

            // Import the createCustomCarousel function
            const { createCustomCarousel } = await import('./express/code/blocks/template-x-promo/template-x-promo.js');
            
            // Call our carousel creation function
            await createCustomCarousel(block, templates);
        }
    </script>
</body>
</html>
