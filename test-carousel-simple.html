<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template X Promo Carousel Test</title>
    <link rel="stylesheet" href="express/code/blocks/template-x-promo/template-x-promo.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        
        .test-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        
        .controls {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .test-btn:hover {
            background: #005a9e;
        }
        
        .info-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #007acc;
        }
        
        .status {
            font-family: monospace;
            background: #333;
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        /* Mock section and block setup */
        .section.ax-template-x-promo {
            background: white;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
        }
        
        .template-x-promo {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">üé† Template X Promo Carousel Testing</h1>
        
        <div class="info-panel">
            <strong>Testing Instructions:</strong>
            <ul>
                <li>üñ•Ô∏è <strong>Desktop (‚â•768px):</strong> All templates show side-by-side, no buttons</li>
                <li>üì± <strong>Mobile (<768px):</strong> 3-up carousel with prev-CURRENT-next, buttons bottom-right</li>
                <li>üîÑ <strong>Resize window</strong> to test responsive behavior</li>
                <li>üéØ <strong>Test different counts</strong> using buttons below</li>
            </ul>
        </div>
        
        <div class="controls">
            <button class="test-btn" onclick="testCarousel(4)">4 Templates</button>
            <button class="test-btn" onclick="testCarousel(3)">3 Templates</button>
            <button class="test-btn" onclick="testCarousel(2)">2 Templates</button>
            <button class="test-btn" onclick="getCurrentInfo()">Get Status</button>
            <button class="test-btn" onclick="location.reload()">Reload Test</button>
        </div>
        
        <div id="status" class="status">Loading carousel...</div>
        
        <!-- Mock section container -->
        <div class="section ax-template-x-promo multiple-up">
            <div class="template-x-promo horizontal three template-x" data-block-status="loaded" id="carousel-block">
                <!-- This will be populated by our JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Mock data for testing
        const mockTemplates = [
            {
                'dc:title': { 'i-default': 'Good Morning Template 1' },
                thumbnail: 'https://via.placeholder.com/255x340/FF6B6B/ffffff?text=Template+1',
                licensingCategory: 'free',
                customLinks: { branchUrl: '#template1' }
            },
            {
                'dc:title': { 'i-default': 'Good Morning Template 2' },
                thumbnail: 'https://via.placeholder.com/255x340/4ECDC4/ffffff?text=Template+2',
                licensingCategory: 'premium',
                customLinks: { branchUrl: '#template2' }
            },
            {
                'dc:title': { 'i-default': 'Good Morning Template 3' },
                thumbnail: 'https://via.placeholder.com/255x340/45B7D1/ffffff?text=Template+3',
                licensingCategory: 'free',
                customLinks: { branchUrl: '#template3' }
            },
            {
                'dc:title': { 'i-default': 'Good Morning Template 4' },
                thumbnail: 'https://via.placeholder.com/255x340/96CEB4/ffffff?text=Template+4',
                licensingCategory: 'premium',
                customLinks: { branchUrl: '#template4' }
            }
        ];

        // Global test variables
        let currentCarousel = null;

        // Mock utility functions
        function createTag(tag, attributes = {}) {
            const element = document.createElement(tag);
            Object.entries(attributes).forEach(([key, value]) => {
                if (key === 'class') {
                    element.className = value;
                } else {
                    element.setAttribute(key, value);
                }
            });
            return element;
        }

        function getIconElementDeprecated(iconName) {
            const icon = document.createElement('div');
            icon.className = `icon icon-${iconName}`;
            icon.textContent = iconName === 'premium' ? 'üëë' : 'üì§';
            return icon;
        }

        // Simple carousel implementation for testing
        function createTestCarousel(block, templates) {
            const isMobile = () => window.innerWidth < 768;
            let currentIndex = 0;

            // Create carousel structure
            const carouselWrapper = createTag('div', { class: 'promo-carousel-wrapper' });
            const carouselViewport = createTag('div', { class: 'promo-carousel-viewport' });
            const carouselTrack = createTag('div', { class: 'promo-carousel-track' });

            // Create navigation
            const navContainer = createTag('div', { class: 'promo-nav-controls' });
            const prevButton = createTag('button', { class: 'promo-nav-btn promo-prev-btn' });
            prevButton.innerHTML = '‚Üê';
            const nextButton = createTag('button', { class: 'promo-nav-btn promo-next-btn' });
            nextButton.innerHTML = '‚Üí';
            navContainer.append(prevButton, nextButton);

            carouselViewport.append(carouselTrack);
            carouselWrapper.append(carouselViewport, navContainer);

            // Create template elements
            function createTemplateElement(templateData) {
                const templateEl = createTag('div', { class: 'promo-template' });
                const imageWrapper = createTag('div', { class: 'promo-image-wrapper' });
                
                const img = createTag('img', {
                    src: templateData.thumbnail,
                    alt: templateData['dc:title']['i-default'],
                    loading: 'lazy'
                });
                
                imageWrapper.append(img);

                // Add tags
                if (templateData.licensingCategory === 'free') {
                    const freeTag = createTag('span', { class: 'promo-plan-tag' });
                    freeTag.textContent = 'Free';
                    imageWrapper.append(freeTag);
                } else {
                    const premiumIcon = getIconElementDeprecated('premium');
                    premiumIcon.classList.add('promo-premium-icon');
                    imageWrapper.append(premiumIcon);
                }

                templateEl.append(imageWrapper);
                return templateEl;
            }

            // Update display based on mobile/desktop
            function updateDisplay() {
                carouselTrack.innerHTML = '';
                
                if (isMobile()) {
                    // Mobile: 3-up carousel
                    const prevIndex = (currentIndex - 1 + templates.length) % templates.length;
                    const nextIndex = (currentIndex + 1) % templates.length;
                    
                    const prevTemplate = createTemplateElement(templates[prevIndex]);
                    const currentTemplate = createTemplateElement(templates[currentIndex]);
                    const nextTemplate = createTemplateElement(templates[nextIndex]);
                    
                    prevTemplate.classList.add('prev-template');
                    currentTemplate.classList.add('current-template');
                    nextTemplate.classList.add('next-template');
                    
                    carouselTrack.append(prevTemplate, currentTemplate, nextTemplate);
                } else {
                    // Desktop: all templates
                    templates.forEach(template => {
                        const templateEl = createTemplateElement(template);
                        carouselTrack.append(templateEl);
                    });
                }
            }

            // Navigation handlers
            nextButton.addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % templates.length;
                updateDisplay();
            });

            prevButton.addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + templates.length) % templates.length;
                updateDisplay();
            });

            // Resize handler
            window.addEventListener('resize', updateDisplay);

            // Initialize
            block.innerHTML = '';
            block.append(carouselWrapper);
            updateDisplay();

            return {
                updateDisplay,
                setTemplateCount: (count) => {
                    templates = mockTemplates.slice(0, count);
                    updateDisplay();
                }
            };
        }

        // Test functions
        function testCarousel(count) {
            const block = document.getElementById('carousel-block');
            const templates = mockTemplates.slice(0, count);
            
            document.getElementById('status').textContent = `üß™ Testing ${count} templates...`;
            
            try {
                currentCarousel = createTestCarousel(block, templates);
                document.getElementById('status').textContent = `‚úÖ Showing ${count} templates! Resize window to test responsive behavior.`;
            } catch (error) {
                document.getElementById('status').textContent = `‚ùå Error: ${error.message}`;
                console.error(error);
            }
        }

        function getCurrentInfo() {
            const isMobile = window.innerWidth < 768;
            document.getElementById('status').textContent = 
                `üìä Current: ${isMobile ? 'Mobile' : 'Desktop'} (${window.innerWidth}px)`;
        }

        // Initialize with 4 templates
        document.addEventListener('DOMContentLoaded', () => {
            testCarousel(4);
        });
    </script>
</body>
</html>
